name: Deploy Flutter Web to cPanel

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: ⚙️ Set up Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: 'stable'

      - name: 🚚 Get latest code
        uses: actions/checkout@v3

      - name: 📂 Build Flutter web
        run: flutter config web && flutter build web

      - name: 📂 Sync files
        uses: SamKirkland/FTP-Deploy-Action@v4.3.4
        with:
          server: ${{ secrets.SERVER }}
          username: ${{ secrets.USERNAME }}
          password: ${{ secrets.PASSWORD }}
          local-path: ./build/web
      - name: Wrong API
        if: failure()
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: |
            ${{ secrets.DISCORD_1 }}
          username: 'Sdirbinsen Alert'
          message: 'Failed, Please Check FLutter Again'

      - name: Deployment
        if: always()
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: |
            ${{ secrets.DISCORD_1 }}
          username: 'Sdirbinsen Alert'
          message: 'Deployment Flutter Searcher'
